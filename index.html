<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sport op TV Vanavond</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --bg: #f5f7fa;
            --card-bg: #ffffff;
            --text: #202124;
            --text-secondary: #5f6368;
            --border: #e0e0e0;
            --success: #34a853;
            --football: #4caf50;
            --darts: #ff5722;
            --f1: #e10600;
            --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-hover: 0 4px 16px rgba(0,0,0,0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 8px;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Sport Tabs */
        .sport-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .sport-tab {
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--card-bg);
            color: var(--text-secondary);
            box-shadow: var(--shadow);
        }

        .sport-tab:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .sport-tab.active[data-sport="voetbal"] {
            background: var(--football);
            color: white;
        }

        .sport-tab.active[data-sport="darts"] {
            background: var(--darts);
            color: white;
        }

        .sport-tab.active[data-sport="f1"] {
            background: var(--f1);
            color: white;
        }

        /* Filters Row - Clean & Minimal */
        .filters-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            color: var(--text);
            cursor: pointer;
            min-width: 140px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85rem;
            width: 140px;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-input::placeholder {
            color: #aaa;
        }

        .filters-spacer {
            flex: 1;
        }

        /* Toggle Section */
        .toggle-section {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .slim-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            user-select: none;
        }

        .slim-toggle input {
            display: none;
        }

        .slim-toggle .slider {
            width: 32px;
            height: 18px;
            background: #ddd;
            border-radius: 9px;
            position: relative;
            transition: background 0.2s;
        }

        .slim-toggle .slider::after {
            content: '';
            position: absolute;
            width: 14px;
            height: 14px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .slim-toggle input:checked + .slider {
            background: var(--primary);
        }

        .slim-toggle input:checked + .slider::after {
            transform: translateX(14px);
        }

        .slim-toggle .label {
            font-size: 0.8rem;
            color: #666;
        }

        @media (max-width: 600px) {
            .filters-row {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-select, .filter-input {
                width: 100%;
            }

            .filters-spacer {
                display: none;
            }

            .toggle-section {
                justify-content: center;
                padding-top: 8px;
            }
        }

        /* Event Cards */
        .events-container {
            margin-top: 20px;
        }

        .day-section {
            margin-bottom: 32px;
        }

        .day-header {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }

        .event-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 12px;
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
            display: grid;
            grid-template-columns: 55px 1fr 50px 80px;
            gap: 12px;
            align-items: center;
        }

        .event-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .event-time {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary);
        }

        .event-details {
            flex: 1;
        }

        .event-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .event-meta {
            display: flex;
            gap: 16px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            flex-wrap: wrap;
        }

        .event-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .event-channel {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
        }

        .channel-logo {
            height: 28px;
            width: auto;
            border-radius: 4px;
        }

        .channel-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
        }

        /* Club logos */
        .club-logo {
            height: 24px;
            width: 24px;
            object-fit: contain;
            vertical-align: middle;
            margin: 0 6px;
            border-radius: 2px;
        }

        .club-logo[src=""] {
            display: none;
        }

        .team-name {
            vertical-align: middle;
        }

        /* Past events styling */
        .past-day {
            opacity: 0.7;
        }

        .past-day .day-header {
            color: #888;
        }

        .past-event {
            background: #f5f5f5;
        }

        /* Score column */
        .event-score-col {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--success);
            text-align: center;
            min-width: 50px;
            visibility: hidden;
        }

        .show-scores .event-score-col {
            visibility: visible;
        }

        .event-score-col.no-score {
            color: #ccc;
        }

        /* Live indicator */
        .live-badge {
            background: #e10600;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Competition badge */
        .competition-badge {
            background: var(--bg);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.85rem;
        }

        /* Loading & Error states */
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .loading .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 40px 20px;
            color: #d32f2f;
            background: #ffebee;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        /* No events message */
        .no-events {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .no-events .icon {
            font-size: 4rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .no-events h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
        }

        /* API Status */
        .api-status {
            text-align: center;
            padding: 4px;
            font-size: 0.7rem;
            color: #999;
            margin-bottom: 8px;
            margin-bottom: 16px;
        }

        .api-status .live-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 6px;
            animation: pulse 2s infinite;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 12px;
            }

            .event-card {
                grid-template-columns: 50px 1fr 40px;
                gap: 8px;
            }

            .event-card .event-channel {
                display: none;
            }

            .event-time {
                font-size: 1rem;
            }

            .event-score-col {
                font-size: 0.9rem;
            }

            .sport-tab {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }

        /* Sport-specific accent colors */
        .sport-voetbal .event-time { color: var(--football); }
        .sport-darts .event-time { color: var(--darts); }
        .sport-f1 .event-time { color: var(--f1); }

        .sport-voetbal .day-header { border-color: var(--football); }
        .sport-darts .day-header { border-color: var(--darts); }
        .sport-f1 .day-header { border-color: var(--f1); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sport op TV</h1>
            <p>Bekijk welke wedstrijden er vandaag op TV zijn</p>
        </header>

        <!-- Sport Tabs -->
        <div class="sport-tabs">
            <button class="sport-tab active" data-sport="voetbal">Voetbal</button>
            <button class="sport-tab" data-sport="darts">Darts</button>
            <button class="sport-tab" data-sport="f1">Formule 1</button>
        </div>

        <!-- Filters Panel -->
        <div class="filters-row" id="filters-row">
            <select class="filter-select" id="filter-competition">
                <option value="">Alle competities</option>
                <option value="Eredivisie">Eredivisie</option>
                <option value="Premier League">Premier League</option>
                <option value="Bundesliga">Bundesliga</option>
                <option value="La Liga">La Liga</option>
                <option value="Serie A">Serie A</option>
                <option value="Ligue 1">Ligue 1</option>
                <option value="Champions League">Champions League</option>
                <option value="Europa League">Europa League</option>
                <option value="Conference League">Conference League</option>
                <option value="FA Cup">FA Cup</option>
                <option value="League Cup">League Cup</option>
                <option value="Coppa Italia">Coppa Italia</option>
                <option value="DFB Pokal">DFB Pokal</option>
                <option value="Copa del Rey">Copa del Rey</option>
                <option value="KNVB Beker">KNVB Beker</option>
            </select>
            <input type="text" class="filter-input" id="filter-clubs" placeholder="Club zoeken...">
            <div class="filters-spacer"></div>
            <div class="toggle-section">
                <label class="slim-toggle">
                    <input type="checkbox" id="toggle-past">
                    <span class="slider"></span>
                    <span class="label">Verleden</span>
                </label>
                <label class="slim-toggle">
                    <input type="checkbox" id="toggle-scores">
                    <span class="slider"></span>
                    <span class="label">Uitslagen</span>
                </label>
            </div>
        </div>

        <!-- API Status -->
        <div class="api-status" id="api-status">
            <span class="live-dot"></span> <span class="status-text">Laden...</span>
        </div>

        <!-- Events Container -->
        <div class="events-container" id="events-container">
            <!-- Events will be rendered here -->
        </div>

        <footer>
            <p>Sport op TV &mdash; Geen reclame, gewoon overzicht</p>
            <p style="margin-top: 8px; font-size: 0.8rem;">
                Data: API-Football, OpenF1
            </p>
        </footer>
    </div>

    <script>
        console.log('ðŸš€ Script starting...');

        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            // API-Football key (gratis 100 requests/dag op api-football.com)
            API_FOOTBALL_KEY: '6299b9b25468371fa7878f188ca297c0',
            API_FOOTBALL_URL: 'https://v3.football.api-sports.io',

            // API-Football league IDs voor relevante competities
            API_FOOTBALL_LEAGUES: [
                // Leagues
                { id: 88, name: 'Eredivisie', channel: 'ESPN' },
                { id: 39, name: 'Premier League', channel: 'Viaplay' },
                { id: 78, name: 'Bundesliga', channel: 'Viaplay' },
                { id: 140, name: 'La Liga', channel: 'Ziggo Sport' },
                { id: 135, name: 'Serie A', channel: 'Ziggo Sport' },
                { id: 61, name: 'Ligue 1', channel: 'Ziggo Sport' },
                // Cups
                { id: 45, name: 'FA Cup', channel: 'Viaplay' },
                { id: 48, name: 'League Cup', channel: 'Viaplay' },
                { id: 137, name: 'Coppa Italia', channel: 'Ziggo Sport' },
                { id: 81, name: 'DFB Pokal', channel: 'Viaplay' },
                { id: 143, name: 'Copa del Rey', channel: 'Ziggo Sport' },
                { id: 66, name: 'Coupe de France', channel: 'Ziggo Sport' },
                { id: 102, name: 'KNVB Beker', channel: 'ESPN' },
                // European
                { id: 2, name: 'Champions League', channel: 'Ziggo Sport' },
                { id: 3, name: 'Europa League', channel: 'Ziggo Sport' },
                { id: 848, name: 'Conference League', channel: 'Ziggo Sport' }
            ],

            // OpenF1 API (gratis, geen key nodig)
            F1_API_URL: 'https://api.openf1.org/v1',

            // TheSportsDB API (gratis, geen key nodig - key 3 is free tier)
            THESPORTSDB_URL: 'https://www.thesportsdb.com/api/v1/json/3',
            DARTS_LEAGUE_ID: '4554', // PDC Darts

            // Competities voor OpenFootball
            LEAGUES: [
                { file: 'nl.1.json', name: 'Eredivisie', channel: 'ESPN' },
                { file: 'en.1.json', name: 'Premier League', channel: 'Viaplay' },
                { file: 'de.1.json', name: 'Bundesliga', channel: 'Viaplay' },
                { file: 'es.1.json', name: 'La Liga', channel: 'Ziggo Sport' },
                { file: 'it.1.json', name: 'Serie A', channel: 'Ziggo Sport' },
                { file: 'fr.1.json', name: 'Ligue 1', channel: 'Ziggo Sport' }
            ],

            // Nederlandse TV zenders mapping
            TV_CHANNELS: {
                'Eredivisie': 'ESPN',
                'Premier League': 'Viaplay',
                'Primera Division': 'Ziggo Sport',
                'La Liga': 'Ziggo Sport',
                'Bundesliga': 'Viaplay',
                'Serie A': 'Ziggo Sport',
                'Ligue 1': 'Ziggo Sport',
                'FA Cup': 'Viaplay',
                'League Cup': 'Viaplay',
                'Coppa Italia': 'Ziggo Sport',
                'DFB Pokal': 'Viaplay',
                'Copa del Rey': 'Ziggo Sport',
                'Coupe de France': 'Ziggo Sport',
                'KNVB Beker': 'ESPN',
                'Champions League': 'Ziggo Sport',
                'Europa League': 'Ziggo Sport',
                'Conference League': 'Ziggo Sport',
                'Formula 1': 'Viaplay',
                'Darts': 'Viaplay / RTL7'
            },

            // TV kanaal logo's (inline SVG data URLs - fully encoded)
            CHANNEL_LOGOS: {
                'ESPN': 'data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 100 40%22%3E%3Crect fill%3D%22%23d00%22 width%3D%22100%22 height%3D%2240%22 rx%3D%224%22%2F%3E%3Ctext x%3D%2250%22 y%3D%2228%22 fill%3D%22white%22 font-family%3D%22Arial%22 font-size%3D%2218%22 text-anchor%3D%22middle%22 font-weight%3D%22bold%22%3EESPN%3C%2Ftext%3E%3C%2Fsvg%3E',
                'Viaplay': 'data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 100 40%22%3E%3Crect fill%3D%22%236b21a8%22 width%3D%22100%22 height%3D%2240%22 rx%3D%224%22%2F%3E%3Ctext x%3D%2250%22 y%3D%2227%22 fill%3D%22white%22 font-family%3D%22Arial%22 font-size%3D%2214%22 text-anchor%3D%22middle%22 font-weight%3D%22bold%22%3EVIAPLAY%3C%2Ftext%3E%3C%2Fsvg%3E',
                'Ziggo Sport': 'data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 100 40%22%3E%3Crect fill%3D%22%23f60%22 width%3D%22100%22 height%3D%2240%22 rx%3D%224%22%2F%3E%3Ctext x%3D%2250%22 y%3D%2227%22 fill%3D%22white%22 font-family%3D%22Arial%22 font-size%3D%2212%22 text-anchor%3D%22middle%22 font-weight%3D%22bold%22%3EZIGGO%3C%2Ftext%3E%3C%2Fsvg%3E',
                'RTL7': 'data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 100 40%22%3E%3Crect fill%3D%22%2300a0e1%22 width%3D%22100%22 height%3D%2240%22 rx%3D%224%22%2F%3E%3Ctext x%3D%2250%22 y%3D%2228%22 fill%3D%22white%22 font-family%3D%22Arial%22 font-size%3D%2216%22 text-anchor%3D%22middle%22 font-weight%3D%22bold%22%3ERTL7%3C%2Ftext%3E%3C%2Fsvg%3E',
                'Viaplay / RTL7': 'data:image/svg+xml,%3Csvg xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22 viewBox%3D%220 0 100 40%22%3E%3Crect fill%3D%22%236b21a8%22 width%3D%2250%22 height%3D%2240%22%2F%3E%3Crect x%3D%2250%22 fill%3D%22%2300a0e1%22 width%3D%2250%22 height%3D%2240%22%2F%3E%3Ctext x%3D%2225%22 y%3D%2225%22 fill%3D%22white%22 font-family%3D%22Arial%22 font-size%3D%228%22 text-anchor%3D%22middle%22%3EVIA%3C%2Ftext%3E%3Ctext x%3D%2275%22 y%3D%2225%22 fill%3D%22white%22 font-family%3D%22Arial%22 font-size%3D%229%22 text-anchor%3D%22middle%22%3ERTL7%3C%2Ftext%3E%3C%2Fsvg%3E'
            }
        };

        // ============================================
        // STATE
        // ============================================
        let currentSport = 'voetbal';
        let showScores = false;
        let showPast = false;
        // Load filters from localStorage
        let filters = {
            competition: localStorage.getItem('selectedCompetition') || '',
            club: localStorage.getItem('selectedClub') || ''
        };
        let cachedData = {
            voetbal: null,
            darts: null,
            f1: null
        };

        // ============================================
        // DARTS DATA (Statisch - geen gratis API beschikbaar)
        // Premier League Darts 2025 kalender
        // ============================================
        const dartsCalendar = [
            // Week 1
            { date: '2025-02-06', time: '19:30', event: 'Premier League Darts', location: 'Belfast', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-02-13', time: '19:30', event: 'Premier League Darts', location: 'Cardiff', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-02-20', time: '19:30', event: 'Premier League Darts', location: 'Liverpool', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-02-27', time: '19:30', event: 'Premier League Darts', location: 'Manchester', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-03-06', time: '19:30', event: 'Premier League Darts', location: 'Exeter', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-03-13', time: '19:30', event: 'Premier League Darts', location: 'Rotterdam Ahoy', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-03-20', time: '19:30', event: 'Premier League Darts', location: 'Newcastle', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-03-27', time: '19:30', event: 'Premier League Darts', location: 'Sheffield', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-04-03', time: '19:30', event: 'Premier League Darts', location: 'Aberdeen', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-04-10', time: '19:30', event: 'Premier League Darts', location: 'Dublin', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-04-17', time: '19:30', event: 'Premier League Darts', location: 'Leeds', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-04-24', time: '19:30', event: 'Premier League Darts', location: 'Birmingham', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-05-01', time: '19:30', event: 'Premier League Darts', location: 'Brighton', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-05-08', time: '19:30', event: 'Premier League Darts', location: 'Glasgow', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-05-15', time: '19:30', event: 'Premier League Darts', location: 'Nottingham', players: ['Van Gerwen', 'Price', 'Littler', 'Wright', 'Smith', 'Cross', 'Aspinall', 'Van den Bergh'], channel: 'Viaplay' },
            { date: '2025-05-22', time: '19:00', event: 'Premier League Darts - Play-Offs', location: 'London O2', players: ['Top 4'], channel: 'Viaplay' },
            // UK Open 2025
            { date: '2025-02-28', time: '13:00', event: 'UK Open - Dag 1', location: 'Minehead', players: ['Alle PDC spelers'], channel: 'Viaplay' },
            { date: '2025-03-01', time: '13:00', event: 'UK Open - Dag 2', location: 'Minehead', players: ['Alle PDC spelers'], channel: 'Viaplay' },
            { date: '2025-03-02', time: '13:00', event: 'UK Open - Finale', location: 'Minehead', players: ['Finalisten'], channel: 'Viaplay' },
        ];

        // ============================================
        // API FUNCTIONS
        // ============================================

        // Fetch F1 sessions from OpenF1 API
        async function fetchF1Sessions() {
            try {
                const response = await fetch(`${CONFIG.F1_API_URL}/sessions?year=2025`);
                if (!response.ok) throw new Error('F1 API error');
                const sessions = await response.json();

                return sessions.map(session => ({
                    date: new Date(session.date_start),
                    time: new Date(session.date_start).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' }),
                    title: session.session_name,
                    competition: `GP ${session.country_name}`,
                    circuit: session.circuit_short_name,
                    channel: 'Viaplay',
                    type: session.session_type,
                    live: isLiveNow(session.date_start, session.date_end),
                    score: null
                }));
            } catch (error) {
                console.error('F1 API Error:', error);
                return [];
            }
        }

        // Fetch football matches - uses OpenFootball (reliable) with Football-Data.org as enhancement
        async function fetchFootballMatches() {
            console.log('Fetching football matches from API-Football...');

            try {
                const today = new Date();
                const weekAgo = new Date(today);
                weekAgo.setDate(weekAgo.getDate() - 7);
                const twoWeeksAhead = new Date(today);
                twoWeeksAhead.setDate(twoWeeksAhead.getDate() + 14);

                // Get all dates we need
                const allMatches = [];
                const currentDate = new Date(weekAgo);

                // Fetch matches for each day (API-Football requires date parameter)
                while (currentDate <= twoWeeksAhead) {
                    const dateStr = currentDate.toISOString().split('T')[0];

                    try {
                        const response = await fetch(`${CONFIG.API_FOOTBALL_URL}/fixtures?date=${dateStr}`, {
                            headers: {
                                'x-apisports-key': CONFIG.API_FOOTBALL_KEY
                            }
                        });

                        if (response.ok) {
                            const data = await response.json();

                            // Filter only our leagues
                            const leagueIds = CONFIG.API_FOOTBALL_LEAGUES.map(l => l.id);
                            const filtered = data.response.filter(match =>
                                leagueIds.includes(match.league.id)
                            );

                            filtered.forEach(match => {
                                const leagueConfig = CONFIG.API_FOOTBALL_LEAGUES.find(l => l.id === match.league.id);
                                const matchDate = new Date(match.fixture.date);

                                allMatches.push({
                                    date: matchDate,
                                    time: matchDate.toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' }),
                                    home: match.teams.home.name,
                                    away: match.teams.away.name,
                                    homeCrest: match.teams.home.logo,
                                    awayCrest: match.teams.away.logo,
                                    competition: leagueConfig ? leagueConfig.name : match.league.name,
                                    competitionLogo: match.league.logo,
                                    channel: leagueConfig ? leagueConfig.channel : (CONFIG.TV_CHANNELS[match.league.name] || 'Ziggo Sport'),
                                    score: match.goals.home !== null ? `${match.goals.home}-${match.goals.away}` : null,
                                    live: match.fixture.status.short === '1H' || match.fixture.status.short === '2H' || match.fixture.status.short === 'HT',
                                    status: match.fixture.status.short
                                });
                            });
                        }
                    } catch (error) {
                        console.warn(`Failed to fetch ${dateStr}:`, error);
                    }

                    currentDate.setDate(currentDate.getDate() + 1);
                }

                console.log(`Got ${allMatches.length} matches from API-Football`);
                return allMatches;

            } catch (error) {
                console.error('API-Football failed:', error);
                return [];
            }
        }

        // Fetch from OpenFootball GitHub (historical data, updated daily)
        async function fetchFromOpenFootball() {
            const allMatches = [];

            // Fetch all leagues in parallel
            const leaguePromises = CONFIG.LEAGUES.map(async (league) => {
                try {
                    const response = await fetch(`${CONFIG.OPENFOOTBALL_URL}/${league.file}`);
                    if (!response.ok) {
                        console.warn(`Failed to fetch ${league.name}`);
                        return [];
                    }

                    const data = await response.json();
                    const matches = [];

                    // Parse matches - structure is { matches: [...] }
                    if (data.matches && Array.isArray(data.matches)) {
                        data.matches.forEach(match => {
                            const matchDate = new Date(match.date + 'T' + (match.time || '15:00'));
                            const hasScore = match.score && match.score.ft;

                            matches.push({
                                date: matchDate,
                                time: match.time || '15:00',
                                home: match.team1,
                                away: match.team2,
                                competition: league.name,
                                channel: league.channel,
                                score: hasScore ? `${match.score.ft[0]}-${match.score.ft[1]}` : null,
                                live: false,
                                status: hasScore ? 'FINISHED' : 'SCHEDULED'
                            });
                        });
                    }

                    console.log(`Loaded ${matches.length} matches from ${league.name}`);
                    return matches;
                } catch (error) {
                    console.error(`Error fetching ${league.name}:`, error);
                    return [];
                }
            });

            const results = await Promise.all(leaguePromises);
            results.forEach(matches => allMatches.push(...matches));

            console.log(`Total matches loaded: ${allMatches.length}`);

            // Filter to show only matches within 2 weeks range
            const today = new Date();
            const twoWeeksAgo = new Date(today);
            twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
            const twoWeeksAhead = new Date(today);
            twoWeeksAhead.setDate(twoWeeksAhead.getDate() + 14);

            const filtered = allMatches.filter(match =>
                match.date >= twoWeeksAgo && match.date <= twoWeeksAhead
            );

            console.log(`Matches in date range: ${filtered.length}`);
            return filtered;
        }

        // Fetch darts events from TheSportsDB
        async function fetchDartsEvents() {
            console.log('Fetching darts events from TheSportsDB...');
            const allEvents = [];

            try {
                // Fetch next 15 events for PDC Darts
                const nextResponse = await fetch(`${CONFIG.THESPORTSDB_URL}/eventsnextleague.php?id=${CONFIG.DARTS_LEAGUE_ID}`);
                if (nextResponse.ok) {
                    const nextData = await nextResponse.json();
                    if (nextData.events) {
                        nextData.events.forEach(event => {
                            const eventDate = new Date(event.dateEvent + 'T' + (event.strTime || '19:30:00'));
                            allEvents.push({
                                date: eventDate,
                                time: event.strTime ? event.strTime.substring(0, 5) : '19:30',
                                title: event.strEvent,
                                location: event.strVenue || event.strCountry || '',
                                competition: event.strLeague || 'PDC Darts',
                                channel: 'Viaplay',
                                homePlayer: event.strHomeTeam,
                                awayPlayer: event.strAwayTeam,
                                homeBadge: event.strHomeTeamBadge,
                                awayBadge: event.strAwayTeamBadge,
                                score: null,
                                live: false,
                                status: 'SCHEDULED'
                            });
                        });
                    }
                }

                // Fetch last 15 events (past results)
                const pastResponse = await fetch(`${CONFIG.THESPORTSDB_URL}/eventspastleague.php?id=${CONFIG.DARTS_LEAGUE_ID}`);
                if (pastResponse.ok) {
                    const pastData = await pastResponse.json();
                    if (pastData.events) {
                        pastData.events.forEach(event => {
                            const eventDate = new Date(event.dateEvent + 'T' + (event.strTime || '19:30:00'));
                            const hasScore = event.intHomeScore !== null && event.intAwayScore !== null;
                            allEvents.push({
                                date: eventDate,
                                time: event.strTime ? event.strTime.substring(0, 5) : '19:30',
                                title: event.strEvent,
                                location: event.strVenue || event.strCountry || '',
                                competition: event.strLeague || 'PDC Darts',
                                channel: 'Viaplay',
                                homePlayer: event.strHomeTeam,
                                awayPlayer: event.strAwayTeam,
                                homeBadge: event.strHomeTeamBadge,
                                awayBadge: event.strAwayTeamBadge,
                                score: hasScore ? `${event.intHomeScore}-${event.intAwayScore}` : null,
                                live: false,
                                status: hasScore ? 'FINISHED' : 'SCHEDULED'
                            });
                        });
                    }
                }

                console.log(`Got ${allEvents.length} darts events from TheSportsDB`);
                return allEvents;

            } catch (error) {
                console.error('TheSportsDB Darts API failed:', error);
                // Fallback to static calendar
                return getStaticDartsEvents();
            }
        }

        // Get static darts events as fallback
        function getStaticDartsEvents() {
            const events = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            for (let i = -7; i < 90; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];

                dartsCalendar
                    .filter(event => event.date === dateStr)
                    .forEach(event => {
                        events.push({
                            date: new Date(event.date + 'T' + event.time),
                            time: event.time,
                            title: event.event,
                            location: event.location,
                            competition: event.event,
                            channel: event.channel,
                            players: event.players,
                            score: null,
                            live: isLiveNow(event.date + 'T' + event.time, null, 3)
                        });
                    });
            }
            return events;
        }

        // Check if event is live now
        function isLiveNow(startTime, endTime, durationHours = 2) {
            const now = new Date();
            const start = new Date(startTime);
            const end = endTime ? new Date(endTime) : new Date(start.getTime() + durationHours * 60 * 60 * 1000);
            return now >= start && now <= end;
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================

        function formatDate(date) {
            const days = ['Zondag', 'Maandag', 'Dinsdag', 'Woensdag', 'Donderdag', 'Vrijdag', 'Zaterdag'];
            const months = ['januari', 'februari', 'maart', 'april', 'mei', 'juni', 'juli', 'augustus', 'september', 'oktober', 'november', 'december'];

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const compareDate = new Date(date);
            compareDate.setHours(0, 0, 0, 0);

            const diffDays = Math.round((compareDate - today) / (1000 * 60 * 60 * 24));

            if (diffDays === 0) return 'Vandaag';
            if (diffDays === 1) return 'Morgen';
            if (diffDays === -1) return 'Gisteren';

            return `${days[date.getDay()]} ${date.getDate()} ${months[date.getMonth()]}`;
        }

        function isSameDay(date1, date2) {
            return date1.getFullYear() === date2.getFullYear() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getDate() === date2.getDate();
        }

        function showLoading() {
            const container = document.getElementById('events-container');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Wedstrijden ophalen...</p>
                </div>
            `;
        }

        function showError(message) {
            const container = document.getElementById('events-container');
            container.innerHTML = `
                <div class="error-message">
                    <p>${message}</p>
                </div>
            `;
        }

        async function renderEvents() {
            const container = document.getElementById('events-container');
            container.className = `events-container sport-${currentSport}`;

            showLoading();

            let allEvents = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            try {
                if (currentSport === 'f1') {
                    if (!cachedData.f1) {
                        cachedData.f1 = await fetchF1Sessions();
                    }
                    allEvents = cachedData.f1;
                } else if (currentSport === 'voetbal') {
                    if (!cachedData.voetbal) {
                        cachedData.voetbal = await fetchFootballMatches();
                    }
                    allEvents = cachedData.voetbal.filter(e => {
                        // Filter by competition (if selected)
                        if (filters.competition && e.competition !== filters.competition) return false;

                        // Filter by club (if specified)
                        if (filters.club) {
                            const clubLower = filters.club.toLowerCase();
                            const homeMatch = e.home.toLowerCase().includes(clubLower);
                            const awayMatch = e.away.toLowerCase().includes(clubLower);
                            if (!homeMatch && !awayMatch) return false;
                        }

                        return true;
                    });
                } else if (currentSport === 'darts') {
                    // Use static calendar (TheSportsDB returns incorrect data)
                    if (!cachedData.darts) {
                        cachedData.darts = getStaticDartsEvents();
                    }
                    allEvents = cachedData.darts;
                }
            } catch (error) {
                showError('Kon data niet ophalen. Probeer het later opnieuw.');
                return;
            }

            // Update API status
            const statusEl = document.getElementById('api-status');
            if (currentSport === 'voetbal') {
                statusEl.innerHTML = '<span class="live-dot"></span> API-Football';
            } else if (currentSport === 'f1') {
                statusEl.innerHTML = '<span class="live-dot"></span> OpenF1';
            } else if (currentSport === 'darts') {
                statusEl.innerHTML = '<span class="live-dot" style="background: #ff9800;"></span> PDC Kalender';
            } else {
                statusEl.innerHTML = '<span class="live-dot" style="background: #ff9800;"></span> Kalender';
            }

            // Filter events based on date range
            const weekAgo = new Date(today);
            weekAgo.setDate(weekAgo.getDate() - 7);
            const twoWeeksAhead = new Date(today);
            twoWeeksAhead.setDate(twoWeeksAhead.getDate() + 14);

            const filteredEvents = allEvents.filter(e => {
                const eventDate = new Date(e.date);
                eventDate.setHours(0, 0, 0, 0);

                // Always show future events (from today onwards)
                if (eventDate >= today) return true;

                // Show past events only if toggle is active
                if (showPast && eventDate >= weekAgo) return true;

                return false;
            });

            // Group events by date
            const eventsByDate = {};
            filteredEvents.forEach(event => {
                const dateKey = event.date.toISOString().split('T')[0];
                if (!eventsByDate[dateKey]) {
                    eventsByDate[dateKey] = [];
                }
                eventsByDate[dateKey].push(event);
            });

            // Sort dates
            const sortedDates = Object.keys(eventsByDate).sort();

            if (sortedDates.length === 0) {
                const sportNames = { voetbal: 'voetbal', darts: 'darts', f1: 'Formule 1' };
                const icons = { voetbal: '&#9917;', darts: '&#127919;', f1: '&#127959;' };
                container.innerHTML = `
                    <div class="no-events">
                        <div class="icon">${icons[currentSport]}</div>
                        <h3>Geen ${sportNames[currentSport]} gevonden</h3>
                        <p>Er zijn geen uitzendingen gevonden voor de komende periode.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            let todayAnchorSet = false;

            sortedDates.forEach(dateKey => {
                const events = eventsByDate[dateKey];
                const eventDate = new Date(dateKey + 'T12:00:00');
                const isToday = isSameDay(eventDate, today);
                const isPast = eventDate < today;

                // Add anchor for today
                const todayAnchor = isToday && !todayAnchorSet ? 'id="today-anchor"' : '';
                if (isToday) todayAnchorSet = true;

                html += `<div class="day-section ${isPast ? 'past-day' : ''}" ${todayAnchor}>
                    <h2 class="day-header">${isToday ? 'Vandaag' : formatDate(eventDate)}</h2>`;

                events.sort((a, b) => a.time.localeCompare(b.time)).forEach(event => {
                    let titleHtml = '';
                    if (currentSport === 'voetbal') {
                        const homeCrest = event.homeCrest ? `<img src="${event.homeCrest}" class="club-logo" alt="">` : '';
                        const awayCrest = event.awayCrest ? `<img src="${event.awayCrest}" class="club-logo" alt="">` : '';
                        titleHtml = `${homeCrest}<span class="team-name">${event.home}</span> - <span class="team-name">${event.away}</span>${awayCrest}`;
                    } else if (currentSport === 'f1') {
                        titleHtml = event.title;
                    } else if (currentSport === 'darts') {
                        // Show player names if it's a match (has home/away players)
                        if (event.homePlayer && event.awayPlayer) {
                            const homeBadge = event.homeBadge ? `<img src="${event.homeBadge}" class="club-logo" alt="">` : '';
                            const awayBadge = event.awayBadge ? `<img src="${event.awayBadge}" class="club-logo" alt="">` : '';
                            titleHtml = `${homeBadge}${event.homePlayer} vs ${event.awayPlayer}${awayBadge}`;
                        } else {
                            titleHtml = event.title;
                        }
                        if (event.location) {
                            titleHtml += ` <span style="color:#888;font-size:0.9em;">- ${event.location}</span>`;
                        }
                    }

                    const scoreText = event.score || '-';
                    const liveHtml = event.live ? `<span class="live-badge">LIVE</span>` : '';
                    const channelLogo = CONFIG.CHANNEL_LOGOS[event.channel];
                    const channelHtml = channelLogo
                        ? `<img src="${channelLogo}" class="channel-logo" alt="${event.channel}">`
                        : `<span class="channel-text">${event.channel}</span>`;

                    html += `
                        <div class="event-card ${isPast ? 'past-event' : ''}">
                            <div class="event-time">${event.time}</div>
                            <div class="event-details">
                                <div class="event-title">
                                    ${titleHtml}
                                    ${liveHtml}
                                </div>
                                <div class="event-meta">
                                    <span class="competition-badge">${event.competition}</span>
                                    ${event.circuit ? `<span>${event.circuit}</span>` : ''}
                                </div>
                            </div>
                            <div class="event-score-col ${event.score ? '' : 'no-score'}">${scoreText}</div>
                            <div class="event-channel">${channelHtml}</div>
                        </div>
                    `;
                });

                html += '</div>';
            });

            container.innerHTML = html;

            if (showScores) {
                container.classList.add('show-scores');
            }

            // Scroll to today if showing past events
            if (showPast) {
                const todayEl = document.getElementById('today-anchor');
                if (todayEl) {
                    todayEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================

        function updateFilterVisibility() {
            const show = currentSport === 'voetbal';
            const filtersRow = document.getElementById('filters-row');
            if (filtersRow) {
                filtersRow.style.display = show ? 'flex' : 'none';
            }
        }

        document.querySelectorAll('.sport-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.sport-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentSport = tab.dataset.sport;
                updateFilterVisibility();
                renderEvents();
            });
        });

        document.getElementById('toggle-past').addEventListener('change', function() {
            showPast = this.checked;
            renderEvents();
        });

        document.getElementById('toggle-scores').addEventListener('change', function() {
            showScores = this.checked;
            document.getElementById('events-container').classList.toggle('show-scores', showScores);
        });

        // Competition filter dropdown
        const compSelect = document.getElementById('filter-competition');
        compSelect.value = filters.competition;
        compSelect.addEventListener('change', () => {
            filters.competition = compSelect.value;
            localStorage.setItem('selectedCompetition', filters.competition);
            renderEvents();
        });

        // Club filter with debounce
        let clubFilterTimeout;
        const clubInput = document.getElementById('filter-clubs');
        clubInput.value = filters.club;

        clubInput.addEventListener('input', () => {
            clearTimeout(clubFilterTimeout);
            clubFilterTimeout = setTimeout(() => {
                filters.club = clubInput.value.trim();
                localStorage.setItem('selectedClub', filters.club);
                renderEvents();
            }, 300);
        });


        // ============================================
        // INITIALIZATION
        // ============================================
        console.log('ðŸ Initializing...');
        updateFilterVisibility();
        renderEvents();
        console.log('âœ… Init complete');

        // Auto-refresh every 5 minutes
        setInterval(() => {
            cachedData = { voetbal: null, darts: null, f1: null };
            renderEvents();
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
